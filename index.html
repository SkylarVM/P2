<!DOCTYPE html>
<html lang="en" data-theme="tech">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ§ Penguin Companion â€” XP Planner</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Decorative, animated circuit background -->
  <canvas id="circuitBG" aria-hidden="true"></canvas>

  <!-- Header -->
  <header class="app-header">
    <div class="brand">
      <img src="" alt="" aria-hidden="true" class="brand-pinguin" />
      <h1>Penguin Companion â€” XP Planner</h1>
    </div>

    <div class="level-wrap">
      <div id="levelText">Level 1 â€¢ XP 0 â€¢ Coins 0</div>
      <div class="progress"><span id="xpBar" style="width:0%"></span></div>
    </div>

    <button id="openSettings" class="icon-btn" aria-label="Open settings">âš™ï¸</button>
  </header>

  <!-- Main grid -->
  <main class="grid">

    <!-- Tasks -->
    <section class="card" id="tasksCard">
      <div class="card-title">âœ… Tasks</div>
      <div class="row inputs">
        <input id="taskName" placeholder="Task name" />
        <select id="taskCategory">
          <option value="Study">Study</option>
          <option value="Work">Work</option>
          <option value="Self-Care">Self-Care</option>
          <option value="Other">Other</option>
        </select>
        <input id="taskXP" type="number" step="0.25" min="0" placeholder="XP (e.g. 0.25)" />
        <button id="taskAdd" class="primary">Add</button>
      </div>
      <ul id="taskList" class="list"></ul>
    </section>

    <!-- Rewards -->
    <section class="card" id="rewardsCard">
      <div class="card-title">ğŸ Rewards</div>
      <div class="row inputs">
        <input id="rewardName" placeholder="Reward (e.g., Ice cream)" />
        <input id="rewardCost" type="number" step="0.25" min="0" placeholder="Cost (XP)" />
        <button id="rewardAdd" class="primary">Add</button>
      </div>
      <ul id="rewardList" class="list"></ul>
    </section>

    <!-- Category Stats -->
    <section class="card" id="statsCard">
      <div class="card-title">ğŸ“Š Category Stats</div>
      <div class="stats">
        <div class="stat">
          <div class="stat-header"><span>Study</span><b id="pctStudy">0%</b></div>
          <div class="stat-bar"><span id="barStudy" style="width:0%"></span></div>
        </div>
        <div class="stat">
          <div class="stat-header"><span>Work</span><b id="pctWork">0%</b></div>
          <div class="stat-bar"><span id="barWork" style="width:0%"></span></div>
        </div>
        <div class="stat">
          <div class="stat-header"><span>Self-Care</span><b id="pctSelf">0%</b></div>
          <div class="stat-bar"><span id="barSelf" style="width:0%"></span></div>
        </div>
        <div class="stat">
          <div class="stat-header"><span>Other</span><b id="pctOther">0%</b></div>
          <div class="stat-bar"><span id="barOther" style="width:0%"></span></div>
        </div>
      </div>
    </section>

    <!-- Time Blocking -->
    <section class="card" id="scheduleCard">
      <div class="card-title">ğŸ“… Time-Blocking (15-min)</div>
      <div class="row inputs">
        <input id="blockTitle" placeholder="Block title" />
        <input id="blockStart" type="time" step="900" />
        <input id="blockEnd" type="time" step="900" />
        <input id="blockColor" type="color" value="#3b82f6" />
        <button id="addBlock" class="primary">Add</button>
        <button id="addFromTasks" class="ghost">Add from Tasks</button>
        <button id="clearSchedule" class="danger">Clear Schedule</button>
      </div>
      <div class="schedule">
        <div id="scheduleNow" class="schedule-now">ğŸ§</div>
        <div id="scheduleGrid" class="schedule-grid" aria-label="Day timeline"></div>
      </div>
    </section>

    <!-- Pomodoro & Calls -->
    <section class="card" id="pomoCard">
      <div class="card-title">â±ï¸ Pomodoro & ğŸ“ Calls</div>
      <div class="row inputs">
        <label>Focus <input id="pomoFocus" type="number" min="1" value="25" /></label>
        <label>Short <input id="pomoShort" type="number" min="1" value="5" /></label>
        <label>Long <input id="pomoLong" type="number" min="1" value="15" /></label>
        <button id="savePomo" class="ghost">Save</button>
      </div>
      <div class="row">
        <button id="callStudy" class="primary">ğŸ¥ Call Penguin â€” Study</button>
        <button id="callExercise" class="ghost">Exercise</button>
        <button id="callEat" class="ghost">Eat</button>
        <button id="callBath" class="ghost">Bath</button>
        <button id="callSleep" class="ghost">Sleep</button>
        <button id="openPomodoro" class="danger">ğŸ… Open Pomodoro</button>
      </div>
      <small class="muted">Ambient Lab hum is muted by default; toggle in full-screen call. Pomodoro and call are independent.</small>
    </section>

    <!-- Tools -->
    <section class="card" id="toolsCard">
      <div class="card-title">ğŸ§° Tools</div>
      <div class="row">
        <button id="openCalc" class="primary">ğŸ§® Open Calculator</button>
        <button id="openSearch" class="primary">ğŸ” Open Quick Search</button>
      </div>
      <div class="row">
        <input id="alarmTime" type="time" />
        <input id="alarmLabel" placeholder="Alarm label" />
        <select id="alarmSound">
          <option value="soft">Penguin Beep-Boo</option>
          <option value="beep">Digital Beep</option>
          <option value="ping">Clean Ping</option>
        </select>
        <button id="addAlarm" class="primary">Add</button>
      </div>
      <ul id="alarmList" class="list"></ul>
      <hr />
      <div class="row">
        <button id="exportJSON" class="ghost">ğŸ“¤ Export JSON</button>
        <button id="exportCSV" class="ghost">ğŸ“„ Export CSV</button>
        <input id="importFile" type="file" accept=".json,.csv" hidden />
        <button id="importData" class="ghost">ğŸ“¥ Import</button>
      </div>
    </section>

    <!-- History -->
    <section class="card" id="historyCard">
      <div class="card-title">ğŸ—“ï¸ History (Today)</div>
      <div id="historyToday" class="history"></div>
      <button id="clearToday" class="danger small">ğŸ§¹ Clear Todayâ€™s History</button>
    </section>

    <!-- Shop (with avatar preview) -->
    <section class="card" id="shopCard">
      <div class="card-title">ğŸ›ï¸ Penguin Shop</div>
      <div class="shop-preview">
        <div id="shopPreviewAvatar" class="penguin3d" aria-label="Avatar preview"></div>
        <div class="shop-stats">
          <div><b>Coins:</b> <span id="coinsText">0</span></div>
          <div><b>Owned:</b> <span id="ownedCount">0</span></div>
        </div>
      </div>
      <h4 class="sep">Accessories</h4>
      <div id="shopAccessories" class="shop-grid"></div>
      <h4 class="sep">Themes</h4>
      <div id="shopThemes" class="shop-grid"></div>
      <h4 class="sep">Effects</h4>
      <div id="shopEffects" class="shop-grid"></div>
    </section>

    <!-- Race Mode -->
    <section class="card" id="raceCard">
      <div class="card-title">ğŸ Race Mode</div>
      <div id="raceLobby" class="race-lobby">
        <div class="row">
          <button id="createRace" class="primary">Create Room</button>
          <input id="joinCode" placeholder="Enter code" />
          <button id="joinRace" class="ghost">Join</button>
        </div>
        <div id="raceInfo" class="muted"></div>
        <div id="raceParticipants" class="race-list"></div>
        <div class="row">
          <button id="startRace" class="primary" disabled>Start Pomodoro</button>
          <button id="closeRace" class="danger" disabled>Close Room</button>
        </div>
      </div>
      <div id="raceBoard" class="race-board" hidden>
        <div class="row">
          <div class="race-code">Code: <b id="raceCodeView">â€”</b></div>
          <button id="exitRace" class="danger small">Leave</button>
        </div>
        <ul id="raceLeaderboard" class="list"></ul>
        <div id="miniGames" class="minigames" hidden>
          <div class="card-title small">ğŸ® Break Mini-Games</div>
          <div class="row">
            <button id="mgTTT">Tic-Tac-Toe</button>
            <button id="mgC4">Connect-4</button>
            <button id="mgChess" disabled>Chess (soon)</button>
          </div>
          <div id="mgStage"></div>
        </div>
      </div>
    </section>

  </main>

  <!-- Settings (sidebar) -->
  <aside id="settingsPanel" aria-hidden="true">
    <div class="settings-head">
      <div class="title">âš™ï¸ Settings</div>
      <button id="closeSettings" class="icon-btn">âœ–</button>
    </div>

    <div class="settings-section">
      <label class="lbl">Default Theme</label>
      <select id="optTheme">
        <option value="tech">Tech Lab</option>
        <option value="arctic">Arctic Base</option>
        <option value="sunset">Sunset Beach</option>
        <option value="space">Space</option>
      </select>
    </div>

    <div class="settings-section">
      <label class="lbl">Language</label>
      <select id="optLang">
        <option value="en">English</option>
        <option value="es">EspaÃ±ol</option>
      </select>
    </div>

    <div class="settings-section">
      <label class="lbl">Default Sound</label>
      <select id="optSound">
        <option value="soft">Soft Digital</option>
        <option value="beep">Beep-Boop</option>
        <option value="ping">Pure Ping</option>
      </select>
      <label class="lbl">Volume</label>
      <input id="optVolume" type="range" min="0" max="100" value="40" />
    </div>

    <hr />

    <div class="settings-section">
      <div class="title small">ğŸ§ Avatar</div>
      <div id="settingsAvatarPreview" class="penguin3d"></div>
      <div class="row inputs">
        <input id="setAName" placeholder="Name" />
        <input id="setAColor" type="color" value="#7c3aed" />
      </div>
      <div class="row inputs">
        <select id="setAHead"></select>
        <select id="setABody"></select>
      </div>
      <select id="setAEffect"></select>
      <button id="saveAvatarSettings" class="primary full">Save Avatar</button>
    </div>

    <hr />
    <div class="settings-section">
      <div class="title small">Pomodoro Defaults</div>
      <div class="row inputs">
        <label>Focus <input id="setPF" type="number" min="1" value="25"></label>
        <label>Short <input id="setPS" type="number" min="1" value="5"></label>
        <label>Long <input id="setPL" type="number" min="1" value="15"></label>
      </div>
      <label class="chk"><input id="setAutoNext" type="checkbox"> Auto-start next phase</label>
      <button id="recalcBtn" class="ghost full">ğŸŸ¡ Recalculate XP & Coins</button>
      <div class="row">
        <button id="resetTodayBtn" class="ghost">Reset Today Only</button>
        <button id="clearAllBtn" class="danger">Clear All Data</button>
      </div>
    </div>
  </aside>

  <!-- Calculator Modal -->
  <div id="calcModal" class="modal" aria-hidden="true">
    <div class="modal-body calc">
      <div class="modal-head">
        <div class="title">ğŸ§® Calculator</div>
        <button class="icon-btn" id="closeCalc">âœ–</button>
      </div>
      <input id="calcDisplay" readonly />
      <div id="calcKeys" class="calc-grid"></div>
    </div>
  </div>

  <!-- Search Modal -->
  <div id="searchModal" class="modal" aria-hidden="true">
    <div class="modal-body">
      <div class="modal-head">
        <div class="title">ğŸ” Quick Search</div>
        <button class="icon-btn" id="closeSearch">âœ–</button>
      </div>
      <input id="searchQuery" placeholder="Type a definition / conceptâ€¦" />
      <iframe id="searchFrame" title="Embedded search"></iframe>
    </div>
  </div>

  <!-- Call Overlay (floating / fullscreen) -->
  <div id="callOverlay" class="call hidden" aria-live="polite">
    <div class="call-head">
      <div class="title">ğŸ“ Penguin Call â€” <span id="callMode">Study</span></div>
      <div class="call-actions">
        <button id="toggleMute" class="icon-btn" title="Toggle ambient">ğŸ”‡</button>
        <button id="toggleSize" class="icon-btn" title="Toggle fullscreen">â¤¢</button>
        <button id="closeCall" class="icon-btn danger" title="Close">âœ–</button>
      </div>
    </div>
    <div class="call-scene">
      <div id="callPenguin" class="penguin3d big"></div>
      <div id="callBackdrop" class="backdrop tech"></div>
      <div id="pomoMicro" class="microtimer hidden">00:00</div>
    </div>
  </div>

  <!-- Pomodoro Popup -->
  <div id="pomoOverlay" class="pomo hidden" aria-live="polite">
    <div class="pomo-head">
      <div class="title">ğŸ… Focus: <span id="pomoTaskTitle">â€”</span></div>
      <div class="pomo-actions">
        <button id="pomoMin" class="icon-btn">â–</button>
        <button id="pomoClose" class="icon-btn danger">âœ–</button>
      </div>
    </div>
    <div class="pomo-body">
      <div class="pomo-circle"><span id="pomoTime">25:00</span></div>
      <div class="row center">
        <button id="pomoStart" class="primary">Start</button>
        <button id="pomoPause" class="ghost">Pause</button>
        <button id="pomoDone" class="success">Done</button>
        <button id="pomoExit" class="danger">Exit</button>
      </div>
      <small class="muted">Short break (5 min) runs automatically between Pomodoros; mini-games will appear during breaks in Race Mode.</small>
    </div>
  </div>

  <!-- Audio (generated by JS) -->
  <audio id="beepSoft" preload="auto"></audio>
  <audio id="beepBeep" preload="auto"></audio>
  <audio id="beepPing" preload="auto"></audio>

  <script src="script.js"></script>
</body>
</html>
