<!doctype html>
<html lang="en" data-theme="tech">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Penguin Companion — XP Planner</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

  <!-- ===== Header ===== -->
  <header class="app-header">
    <div class="brand">
      <span class="logo">🐧</span>
      <h1>Penguin Companion — XP Planner</h1>
    </div>
    <div class="stats-line" id="levelText">Level 1 • XP 0.0 • Coins 0</div>
    <div class="xp-track">
      <div class="xp-fill" id="xpBar" style="width:0%"></div>
    </div>

    <div class="header-actions">
      <button id="openSettings" class="icon-btn" title="Settings">⚙️</button>
      <button id="exportJSON" class="ghost">Export JSON</button>
      <button id="exportCSV" class="ghost">Export CSV</button>
      <input id="importFile" type="file" accept=".json" hidden>
      <button id="importData" class="ghost">Import</button>
    </div>
  </header>

  <!-- ===== Grid ===== -->
  <main class="grid">
    <!-- Tasks -->
    <section class="card" id="tasksCard">
      <div class="card-title">✅ Tasks</div>

      <div class="row inputs">
        <input id="taskName" class="input" placeholder="Task name" />
        <select id="taskCategory" class="select">
          <option value="Study">Study</option>
          <option value="Work">Work</option>
          <option value="Self-Care">Self-Care</option>
          <option value="Other">Other</option>
        </select>
        <input id="taskXP" type="number" step="0.25" class="input small" placeholder="XP" />
        <button id="taskAdd" class="primary">Add</button>
      </div>

      <ul id="taskList" class="list">
        <!-- populated by JS -->
      </ul>
    </section>

    <!-- Rewards -->
    <section class="card" id="rewardsCard">
      <div class="card-title">🎁 Rewards</div>
      <div class="row inputs">
        <input id="rewardName" class="input" placeholder="Reward (e.g., Ice cream)" />
        <input id="rewardCost" type="number" step="0.25" class="input small" placeholder="Cost XP" />
        <button id="rewardAdd" class="primary">Add</button>
      </div>
      <ul id="rewardList" class="list">
        <!-- populated by JS -->
      </ul>
    </section>

    <!-- Category Stats -->
    <section class="card" id="statsCard">
      <div class="card-title">📊 Category Stats</div>

      <div class="stat-row">
        <div class="stat-label">Study: <span id="countStudy">0</span></div>
        <div class="bar">
          <div id="barStudy" class="bar-fill grad-warm" style="width:0%"></div>
        </div>
      </div>
      <div class="stat-row">
        <div class="stat-label">Work: <span id="countWork">0</span></div>
        <div class="bar">
          <div id="barWork" class="bar-fill grad-green" style="width:0%"></div>
        </div>
      </div>
      <div class="stat-row">
        <div class="stat-label">Self-Care: <span id="countSelfCare">0</span></div>
        <div class="bar">
          <div id="barSelfCare" class="bar-fill grad-cyan" style="width:0%"></div>
        </div>
      </div>
      <div class="stat-row">
        <div class="stat-label">Other: <span id="countOther">0</span></div>
        <div class="bar">
          <div id="barOther" class="bar-fill grad-purple" style="width:0%"></div>
        </div>
      </div>
    </section>

    <!-- Pomodoro & Calls -->
    <section class="card span-2" id="pomocallsCard">
      <div class="card-title">⏱️ Pomodoro & 📞 Calls</div>

      <div class="row">
        <label class="inline">Focus
          <input id="pomoFocus" type="number" class="input xs" value="25" />
        </label>
        <label class="inline">Short
          <input id="pomoShort" type="number" class="input xs" value="5" />
        </label>
        <label class="inline">Long
          <input id="pomoLong" type="number" class="input xs" value="15" />
        </label>
        <button id="savePomo" class="primary">Save</button>
      </div>

      <div class="row wrap gap">
        <button id="openCall" class="primary"><span>🎥 Call Penguin</span></button>
        <button id="callStudy" class="chip">Study</button>
        <button id="callExercise" class="chip">Exercise</button>
        <button id="callEat" class="chip">Eat</button>
        <button id="callBath" class="chip">Bath</button>
        <button id="callSleep" class="chip">Sleep</button>
        <button id="openPomodoro" class="chip tomato">🍅 Open Pomodoro</button>
        <button id="openMeet" class="chip meet">📎 Open Meet</button>
      </div>

      <p class="muted">Ambient Lab hum is muted by default. Toggle & volume available in full-screen call overlay.</p>
    </section>

    <!-- Tools -->
    <section class="card" id="toolsCard">
      <div class="card-title">🧮 & 🔎 Tools</div>
      <div class="row gap">
        <button id="openCalc" class="primary">Open Calculator</button>
        <button id="openSearch" class="primary">Open Quick Search</button>
      </div>
      <p class="muted">Both open as pop-ups so you can keep working.</p>
    </section>

    <!-- Alarms -->
    <section class="card" id="alarmsCard">
      <div class="card-title">⏰ Alarms</div>
      <div class="row inputs">
        <input id="alarmTime" type="time" class="input" />
        <input id="alarmLabel" class="input flex" placeholder="Alarm label (e.g., Go to class)" />
      </div>
      <div class="row gap">
        <select id="alarmSound" class="select">
          <option value="beep">Penguin Beep-Boo</option>
          <option value="bell">Soft Bell</option>
          <option value="digital">Digital Ping</option>
        </select>
        <button id="addAlarm" class="primary">Add</button>
      </div>

      <ul id="alarmList" class="list alarms">
        <!-- populated by JS -->
      </ul>
    </section>

    <!-- Time-Blocking (15-min) -->
    <section class="card span-2" id="timeblockCard">
      <div class="card-title">📅 Time-Blocking (15-min)</div>

      <div class="row inputs">
        <input id="blockTitle" class="input flex" placeholder="Block title" />
        <input id="blockStart" type="time" step="900" class="input small" value="08:00" />
        <span class="dash">—</span>
        <input id="blockEnd" type="time" step="900" class="input small" value="09:00" />
        <input id="blockColor" type="color" class="input small color" value="#3B82F6" />
        <button id="addBlock" class="primary">Add</button>
        <button id="addFromTasks" class="ghost">Add from Tasks</button>
        <button id="clearSchedule" class="ghost danger">Clear Schedule</button>
        <button id="clearToday" class="ghost">Clear Today’s History</button>
      </div>

      <div class="schedule">
        <div id="scheduleGrid" class="schedule-grid"><!-- JS renders --></div>
        <div id="nowMarker" class="now-marker">🐧</div>
      </div>
    </section>

    <!-- Shop (preview) -->
    <section class="card span-2" id="shopCard">
      <div class="card-title">🛍️ Penguin Shop</div>
      <div class="shop-stats">Coins: <b id="coinsText">0</b> • Owned accessories: <b id="ownedCount">0</b></div>
      <div class="shop-grid">
        <div>
          <h4>Accessories</h4>
          <div id="shopAccessories" class="items"></div>
        </div>
        <div>
          <h4>Themes</h4>
          <div id="shopThemes" class="items"></div>
        </div>
        <div>
          <h4>Effects</h4>
          <div id="shopEffects" class="items"></div>
        </div>
      </div>
    </section>

  </main>

  <!-- =========== Overlays / Modals =========== -->

  <!-- Pomodoro overlay -->
  <div id="pomoOverlay" class="overlay hidden">
    <div class="overlay-card">
      <div class="overlay-head">
        <div class="left">
          <div class="title" id="pomoTaskTitle">Focus</div>
        </div>
        <div class="right">
          <button id="pomoMin" class="ghost">Minimize</button>
          <button id="pomoExit" class="danger ghost">Close</button>
        </div>
      </div>

      <div class="pomo-body">
        <div class="pomo-circle" id="pomoCircle">
          <div class="pomo-time" id="pomoTime">25:00</div>
        </div>
      </div>

      <div class="pomo-actions">
        <button id="pomoStart" class="primary">Start</button>
        <button id="pomoPause" class="ghost">Pause</button>
        <button id="pomoDone" class="success">Done</button>
      </div>
    </div>

    <!-- micro timer (appears also inside Call when running) -->
    <div id="pomoMicro" class="pomo-micro hidden">00 min 00 s left</div>
  </div>

  <!-- Call overlay -->
  <div id="callOverlay" class="overlay hidden">
    <div class="overlay-card call-card">
      <div class="overlay-head">
        <div class="left">
          <div class="title"><span id="callName">Pingu</span> — <span id="callModeLabel">Study</span></div>
        </div>
        <div class="right">
          <label class="ambient"><span>🔊 Ambient</span><input id="ambientToggle" type="checkbox"><input id="ambientVol" type="range" min="0" max="1" step="0.01" value="0.35"></label>
          <button id="callMin" class="ghost">Minimize</button>
          <button id="closeCall" class="danger ghost">Close</button>
        </div>
      </div>

      <div class="call-stage">
        <div id="callBackdrop" class="backdrop tech"><!-- theme backdrop --></div>
        <div class="penguin" id="callPenguin">
          <div class="pg-body"></div><div class="pg-face"></div><div class="pg-eye l"></div><div class="pg-eye r"></div><div class="pg-beak"></div>
          <!-- props for activities -->
          <div class="prop prop-pen"></div>
          <div class="prop prop-bar"></div>
          <div class="prop prop-spoon"></div>
          <div class="prop prop-bath"></div>
          <div class="prop prop-zzz"></div>
        </div>
      </div>

      <div class="call-tip">Tip: Open Pomodoro separately if you want both running.</div>
    </div>

    <!-- minimized bubble -->
    <div id="callMini" class="call-mini hidden">
      <div class="mini-penguin"></div>
      <div class="mini-text" id="callMiniText">Studying with you…</div>
      <div class="mini-micro hidden" id="callMiniMicro">00:00</div>
      <button id="callMiniRestore" class="mini-btn">⬆️</button>
      <button id="callMiniClose" class="mini-btn danger">✖</button>
    </div>
  </div>

  <!-- Calculator modal -->
  <div id="calcModal" class="modal">
    <div class="modal-card">
      <div class="modal-head"><div>Calculator</div><button id="closeCalc" class="ghost">✖</button></div>
      <iframe id="calcFrame" title="calc"></iframe>
    </div>
  </div>

  <!-- Search modal -->
  <div id="searchModal" class="modal">
    <div class="modal-card">
      <div class="modal-head"><div>Quick Search</div><button id="closeSearch" class="ghost">✖</button></div>
      <div class="search-row">
        <input id="searchQuery" class="input" placeholder="Type to search…" />
      </div>
      <iframe id="searchFrame" title="search"></iframe>
    </div>
  </div>

  <!-- Settings sidebar -->
  <aside id="settingsPanel" class="settings">
    <div class="settings-head">
      <div class="title">Settings</div>
      <button id="closeSettings" class="ghost">✖</button>
    </div>

    <div class="settings-section">
      <div class="subtitle">Theme & Language</div>
      <label>Default Theme
        <select id="optTheme" class="select">
          <option value="tech">Tech Lab</option>
          <option value="arctic">Arctic Base</option>
          <option value="sunset">Sunset Beach</option>
          <option value="space">Space</option>
        </select>
      </label>
      <label>Language
        <select id="optLang" class="select">
          <option value="en">English</option>
          <option value="es">Español</option>
        </select>
      </label>
    </div>

    <div class="settings-section">
      <div class="subtitle">Pomodoro</div>
      <label>Auto-start next phase
        <input id="optAutoNext" type="checkbox" checked />
      </label>
      <label>Default Sound
        <select id="optSound" class="select">
          <option value="soft">Soft</option>
          <option value="ding">Ding</option>
          <option value="pop">Pop</option>
        </select>
      </label>
      <label>Volume
        <input id="optVolume" type="range" min="0" max="100" value="40" />
      </label>
    </div>

    <div class="settings-section">
      <div class="subtitle">My Penguin</div>
      <div id="settingsAvatarPreview" class="settings-avatar">
        <div class="pg-body"></div><div class="pg-face"></div><div class="pg-eye l"></div><div class="pg-eye r"></div><div class="pg-beak"></div>
      </div>
      <div class="row inputs">
        <input id="setAName" class="input" placeholder="Name (e.g., Pingu)" />
        <input id="setAColor" type="color" class="input color small" />
      </div>
      <div class="row inputs">
        <select id="setAHead" class="select flex"><!-- head accessories options by JS --></select>
        <select id="setABody" class="select flex"><!-- body accessories options by JS --></select>
      </div>
      <div class="row inputs">
        <select id="setAEffect" class="select flex"><!-- effects by JS --></select>
        <button id="saveAvatarSettings" class="primary">Save Avatar</button>
      </div>
    </div>

    <div class="settings-section danger-zone">
      <button id="recalcXP" class="ghost">Recalculate XP & Coins</button>
      <button id="resetTodayOnly" class="ghost">Reset Today Only</button>
      <button id="clearAllData" class="danger ghost">Clear All Data</button>
    </div>
  </aside>

  <!-- Race (Kahoot-style) full-screen -->
  <div id="raceFull" class="race hidden">
    <div class="race-stage">
      <div class="race-head">
        <div class="race-brand">🐧 Penguin Race</div>
        <div class="race-actions">
          <button id="raceClose" class="ghost danger">Exit</button>
        </div>
      </div>

      <div class="race-content" id="raceContent">
        <!-- JS loads: lobby (code), join, participants, start, countdown, shared pomodoro, leaderboard -->
      </div>
    </div>
  </div>

  <!-- Audio -->
  <audio id="alarmBeep" preload="auto">
    <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=" type="audio/wav">
  </audio>

  <script src="script.js"></script>
</body>
</html>
